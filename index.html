09.28 2:58â€¯PM
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Face Detection</title>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
    h1 { color: #222; }
    #home, #trainSection, #detectSection { display: none; }
    video { width: 90%; max-width: 500px; border: 3px solid #333; border-radius: 10px; }
    #logs { margin-top: 20px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; background: #fff; padding: 10px; border-radius: 8px; height: 200px; overflow-y: auto; font-size: 16px; }
    .btn { padding: 10px 20px; margin: 10px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; }
    .btn-train { background: #007bff; color: white; }
    .btn-detect { background: #28a745; color: white; }
    .uploadBox { margin: 10px; padding: 10px; border: 2px dashed #aaa; border-radius: 8px; background: #fff; }
    img.thumb { width: 100px; margin: 5px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>AI Face Recognition</h1>

  <!-- Home screen -->
  <div id="home">
    <button class="btn btn-train" onclick="showTrain()">Train</button>
    <button class="btn btn-detect" onclick="showDetect()">Detect</button>
  </div>

  <!-- Train section -->
  <div id="trainSection">
    <h2>Upload Training Images</h2>
    <div class="uploadBox">
      <p><b>Criminal Images</b></p>
      <input type="file" id="criminalUpload" multiple accept="image/*">
      <div id="criminalPreview"></div>
    </div>
    <div class="uploadBox">
      <p><b>Employee Images</b></p>
      <input type="file" id="employeeUpload" multiple accept="image/*">
      <div id="employeePreview"></div>
    </div>
    <button class="btn btn-detect" onclick="finishTraining()">Save Training</button>
  </div>

  <!-- Detect section -->
  <div id="detectSection">
    <h2>Live Camera Detection</h2>
    <video id="video" autoplay muted></video>
    <div id="logs"></div>
  </div>

  <!-- Siren sounds -->
  <audio id="criminalSound" src="sounds/criminal.mp3"></audio>
  <audio id="employeeSound" src="sounds/employee.mp3"></audio>
  <audio id="unknownSound" src="sounds/unknown.mp3"></audio>

  <script>
    let criminalDescriptors = [];
    let employeeDescriptors = [];

    // Show home after models are loaded
    window.onload = async () => {
      await Promise.all([
        faceapi.nets.ssdMobilenetv1.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models/'),
        faceapi.nets.faceLandmark68Net.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models/'),
        faceapi.nets.faceRecognitionNet.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models/')
      ]);
      document.getElementById("home").style.display = "block";
    };

    function showTrain() {
      document.getElementById("home").style.display = "none";
      document.getElementById("trainSection").style.display = "block";
    }

    function showDetect() {
      document.getElementById("home").style.display = "none";
      document.getElementById("detectSection").style.display = "block";
      startVideo();
    }

    async function finishTraining() {
      alert("Training data saved! Now go to Detect.");
      document.getElementById("trainSection").style.display = "none";
      document.getElementById("home").style.display = "block";
    }

    // Preview and process uploads
    document.getElementById("criminalUpload").addEventListener("change", async (e) => {
      document.getElementById("criminalPreview").innerHTML = "";
      criminalDescriptors = [];
      for (let file of e.target.files) {
        let img = await fileToImage(file);
        document.getElementById("criminalPreview").appendChild(img.cloneNode());
        const detection = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();
        if (detection) criminalDescriptors.push(detection.descriptor);
      }
    });

    document.getElementById("employeeUpload").addEventListener("change", async (e) => {
      document.getElementById("employeePreview").innerHTML = "";
      employeeDescriptors = [];
      for (let file of e.target.files) {
        let img = await fileToImage(file);
        document.getElementById("employeePreview").appendChild(img.cloneNode());
        const detection = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();
        if (detection) employeeDescriptors.push(detection.descriptor);
      }
    });

    function fileToImage(file) {
      return new Promise((resolve) => {
        const img = document.createElement("img");
        img.classList.add("thumb");
        img.src = URL.createObjectURL(file);
        img.onload = () => resolve(img);
      });
    }

    // Start camera
    function startVideo() {
      navigator.mediaDevices.getUserMedia({ video: {} })
        .then(stream => { document.getElementById("video").srcObject = stream; })
        .catch(err => console.error(err));
    }

    // Detection loop
    document.getElementById("video").addEventListener("play", () => {
      const video = document.getElementById("video");
      setInterval(async () => {
        const detection = await faceapi.detectSingleFace(video).withFaceLandmarks().withFaceDescriptor();
        if (detection) {
          let label = "Unknown Person";
          let sound = document.getElementById("unknownSound");

          if (criminalDescriptors.length > 0) {
            const distance = faceapi.euclideanDistance(detection.descriptor, criminalDescriptors[0]);
            if (distance < 0.5) { label = "Criminal"; sound = document.getElementById("criminalSound"); }
          }
          if (employeeDescriptors.length > 0) {
            const distance = faceapi.euclideanDistance(detection.descriptor, employeeDescriptors[0]);
            if (distance < 0.5) { label = "Employee"; sound = document.getElementById("employeeSound"); }
          }

          logEvent(label);
          sound.play();
        }
      }, 2000);
    });

    // Log system
    function logEvent(text) {
      const logBox = document.getElementById("logs");
      const time = new Date().toLocaleTimeString();
      logBox.innerHTML = `<p>[${time}] ${text}</p>` + logBox.innerHTML;
    }
  </script>
</body>
</html>
